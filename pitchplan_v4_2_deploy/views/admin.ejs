<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PitchPlan v4 â€“ Admin</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header class="topbar">
    <div class="left">\1
<p><a href=\"/admin/tools\">Admin Tools: Backup & Restore</a></p></div>
    <div class="right">
      <a class="btn" href="/admin/reports">Reports</a>
      <a class="btn" href="/dashboard">User View</a>
      <form method="POST" action="/logout" style="display:inline"><button class="btn outline" type="submit">Logout</button></form>
    </div>
  </header>

  <main class="container">
    <div class="card">
      <h2>Settings</h2>
      <form method="POST" action="/admin/settings" class="inline">
        <label>Lock future weeks from players
          <select name="lock_future_weeks">
            <option value="1" <%= lock==='1' ? 'selected' : '' %>>On</option>
            <option value="0" <%= lock==='0' ? 'selected' : '' %>>Off</option>
          </select>
        </label>
        <button class="btn" type="submit">Save</button>
      </form>
    </div>

    <div class="grid two">
      <div class="card">
        <div class="title-row">
          <h2>Users</h2>
          <a class="btn" href="/admin/users/new">New User</a>
        </div>
        <table class="table">
          <thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Actions</th></tr></thead>
          <tbody>
            <% users.forEach(u => { %>
              <tr>
                <td><%= u.name %></td>
                <td><%= u.email %></td>
                <td><%= u.is_admin ? 'Admin' : 'Player' %></td>
                <td>
                  <form method="POST" action="/admin/users/<%= u.id %>/reset" class="inline">
                    <input name="password" placeholder="New password" required>
                    <button class="btn small" type="submit">Reset</button>
                  </form>
                  <a class="btn small" href="/admin/player/<%= u.id %>">Detail</a>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <div class="card">
        <div class="title-row">
          <h2>Programs</h2>
          <a class="btn" href="/admin/programs/new">New Program</a>
        </div>
        <table class="table">
          <thead><tr><th>Name</th><th>Updated</th><th>Actions</th></tr></thead>
          <tbody>
            <% programs.forEach(p => { %>
              <tr>
                <td><%= p.name %></td>
                <td><%= p.updated_at %></td>
                <td><a class="btn small" href="/admin/programs/<%= p.id %>/edit">Edit</a></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <h2>Assignments</h2>
      <form method="POST" action="/admin/assignments" class="grid three">
        <label>User
          <select name="user_id" required>
            <% users.forEach(u => { %><option value="<%= u.id %>"><%= u.name %></option><% }) %>
          </select>
        </label>
        <label>Program
          <select name="program_id" required>
            <% programs.forEach(p => { %><option value="<%= p.id %>"><%= p.name %></option><% }) %>
          </select>
        </label>
        <label>Start Date <input type="date" name="start_date" required></label>
        <button class="btn" type="submit">Assign</button>
      </form>

      <table class="table">
        <thead><tr><th>User</th><th>Program</th><th>Start</th><th>Plan</th><th>Detail</th></tr></thead>
        <tbody>
        <% assignments.forEach(a => { %>
          <tr>
            <td><%= a.user_name %></td>
            <td><%= a.program_name %></td>
            <td><%= a.start_date %></td>
            <td>
              <form method="POST" action="/admin/generate" class="inline">
                <input type="hidden" name="assignment_id" value="<%= a.id %>">
                <button class="btn small" type="submit">Generate 6-Week</button>
              </form>
            </td>
            <td><a class="btn small" href="/admin/player/<%= a.user_id %>">Open</a></td>
          </tr>
        <% }) %>
        </tbody>
      </table>
    </div>
  </main>
</body>
</html>
